/******************************************************************************
Copyright (C) nFore Technology Co.,Ltd. 2005-2021

FILE NAME
    utility.c (*Must)

DESCRIPTION
    module responsible for tts selection

*******************************************************************************/

/******************************************************************************
 * Includes
 *******************************************************************************/
#include <stdint.h>
#include "FreeRTOSConfig.h"
#include "Nano100Series.h"
/******************************************************************************
 * Module Preprocessor Constants
 *******************************************************************************/
#define CONSTANT 5

/******************************************************************************
 * Module Preprocessor Macros
 *******************************************************************************/

/******************************************************************************
 * Module Typedefs
 *******************************************************************************/

/******************************************************************************
 * Module Variable Definitions
 *******************************************************************************/
static uint8_t fac_us = 0;
static uint16_t fac_ms = 0;
/******************************************************************************
 * Function Prototypes
 *******************************************************************************/

/******************************************************************************
 * Function Definitions
 *******************************************************************************/
/******************************************************************************
NAME
    delay_init
DESCRIPTION
    Play a numeric string using the TTS plugin
RETURNS
*******************************************************************************/
void delay_init(void)
{
    fac_us = SystemCoreClock / 4000000; // TODO: not sure
    fac_ms = (uint16_t)fac_us * 1000;
}
/******************************************************************************
NAME
    delay_us
DESCRIPTION
    Play a numeric string using the TTS plugin
RETURNS
*******************************************************************************/
void delay_us(uint16_t nus)
{
    uint32_t temp;
    SysTick->LOAD = (uint32_t)nus * fac_us;
    SysTick->VAL = 0x00;
    SysTick->CTRL = 0x01;
    do
    {
        temp = SysTick->CTRL;
    } while ((temp & 0x01) && (!(temp & (1 << 16))));
    SysTick->CTRL = 0x00;
    SysTick->VAL = 0x00;
}
/******************************************************************************
NAME
    delay_ms
DESCRIPTION
    Play a numeric string using the TTS plugin
RETURNS
*******************************************************************************/
void delay_ms(uint16_t nms)
{
    uint32_t temp;
    SysTick->LOAD = (uint32_t)nms * fac_ms;
    SysTick->VAL = 0x00;
    SysTick->CTRL = 0x01;
    do
    {
        temp = SysTick->CTRL;
    } while ((temp & 0x01) && (!(temp & (1 << 16))));
    SysTick->CTRL = 0x00;
    SysTick->VAL = 0x00;
}
/*************** END OF FUNCTIONS *********************************************/
